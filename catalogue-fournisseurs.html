<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Catalogue officiel MULTIPARTS : Découvrez nos marques partenaires pour le secteur industriel en Côte d'Ivoire et Afrique de l'Ouest.">
    <title>Catalogue MULTIPARTS - Marques Partenaires</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    
    <style>
        /* Version_36_Dynamic_Description */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
            color: #1e293b;
            line-height: 1.5;
            scroll-behavior: smooth;
        }
        
        /* --- PRELOADER --- */
        #preloader {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: #ffffff; z-index: 9999;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: opacity 0.5s ease-out, visibility 0.5s;
        }
        .loader-content { text-align: center; width: 80%; max-width: 300px; }
        .loader-bar-bg { width: 100%; height: 6px; background-color: #e2e8f0; border-radius: 3px; margin-top: 20px; overflow: hidden; }
        .loader-bar-fill { height: 100%; width: 0%; background-color: #1e40af; transition: width 0.2s ease; }
        .loader-text { margin-top: 10px; color: #64748b; font-size: 0.9rem; font-weight: 600; }
        body.loading { overflow: hidden; }

        /* --- ONBOARDING GUIDE --- */
        #onboarding-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); z-index: 60; display: none; opacity: 0; transition: opacity 0.3s;
        }
        .onboarding-tooltip {
            position: absolute; background-color: #1e40af; color: white;
            padding: 12px 16px; border-radius: 8px; font-size: 0.9rem; font-weight: 500;
            z-index: 70; box-shadow: 0 8px 20px rgba(0,0,0,0.4);
            opacity: 0; transition: opacity 0.3s, transform 0.3s;
            pointer-events: none; max-width: 250px; text-align: center;
            line-height: 1.4;
        }
        
        @media screen and (max-width: 640px) {
            .onboarding-tooltip {
                max-width: 200px; 
                white-space: normal;
            }
        }

        .onboarding-tooltip::after {
            content: ''; position: absolute; top: -6px; left: 50%; transform: translateX(-50%);
            border-width: 0 6px 6px; border-style: solid; border-color: transparent transparent #1e40af transparent;
        }

        .onboarding-tooltip.tooltip-top::after {
            top: auto; bottom: -6px;
            border-width: 6px 6px 0 6px;
            border-color: #1e40af transparent transparent transparent;
        }

        .onboarding-tooltip.show { opacity: 1; transform: translateY(12px); }
        .onboarding-tooltip.tooltip-top.show { transform: translateY(-12px); }
        
        /* Highlight */
        .highlight-element {
            position: relative; z-index: 71; background-color: white;
            border-radius: 6px; box-shadow: 0 0 0 4px rgba(255, 255, 255, 0.9), 0 0 15px rgba(0,0,0,0.5);
        }

        .catalog-page {
            background-color: white; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            margin: 10px auto; max-width: 900px; padding: 20px; min-height: 1200px; position: relative;
        }
        .header { border-bottom: 4px solid #1e40af; padding-bottom: 10px; margin-bottom: 15px; }

        /* Tableaux */
        .table-custom { border-collapse: collapse; width: 100%; }
        .table-custom th { background-color: #e0e7ff; color: #1e40af; font-weight: 700; padding: 8px; text-align: left; }
        .table-custom td { padding: 8px; border-bottom: 1px solid #e5e7eb; }
        .table-custom tr:hover, .table-custom tr.show { background-color: #119248 !important; color: #fff !important; transition: background 0.13s; }
        
        @media screen and (max-width: 639px) {
            .table-custom { display: block; overflow-x: auto; white-space: nowrap; }
            .table-custom thead, .table-custom tbody, .table-custom th, .table-custom td, .table-custom tr { display: block; }
            .table-custom th, .table-custom td { padding: 6px; }
        }

        .brand-row td:first-child { position: relative; } 
        .consumables-inline { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 100%; color: #0f172a; font-size: 0.95rem; }
        
        /* Popup Consommables */
        .consumables-popup {
            display: none; position: absolute; left: 100%; top: 0; margin-left: 12px; width: 360px; max-width: calc(100vw - 40px);
            max-height: 320px; overflow-y: auto; background: #ffffff; border: 1px solid rgba(0,0,0,0.12);
            box-shadow: 0 10px 30px rgba(2,6,23,0.12); padding: 0.6rem; border-radius: 8px; z-index: 60; color: #0b1220; font-size: 0.95rem; line-height: 1.4;
        }
        .consumables-popup::before { content: ""; position: absolute; left: -8px; top: 12px; border-top: 8px solid transparent; border-bottom: 8px solid transparent; border-right: 8px solid #fff; filter: drop-shadow(-1px 1px 0 rgba(0,0,0,0.03)); }
        
        .brand-row:hover td:first-child .consumables-popup, 
        .brand-row:focus-within td:first-child .consumables-popup, 
        .brand-row.show td:first-child .consumables-popup { display: block; }
        
        @media screen and (max-width: 639px) {
          .consumables-popup { position: static; left: auto; top: auto; margin-left: 0; width: 100%; max-height: none; box-shadow: none; border-radius: 6px; margin-top: 6px; }
          .consumables-popup::before { display: none; }
        }

        .no-screen { display: none !important; }        
        .section-header { display: flex; align-items: center; justify-content: space-between; margin-top: 30px; margin-bottom: 15px; border-left: 4px solid #1e40af; padding-left: 10px; }
        .section-header h3 { font-size: 1.15rem; font-weight: bold; color: #1e40af; margin: 0; padding-left: 10px; line-height: 1.25; }
        @media screen and (min-width: 640px) { .section-header h3 { font-size: 1.5rem; } }
        
        .toggle-details-btn { margin-left: 1rem; font-size: 0.95rem; background: transparent; color: #119248; border: 1px solid transparent; cursor: pointer; padding: 6px 10px; border-radius: 6px; transition: background 0.16s, color 0.16s, border-color 0.16s; display: inline-flex; align-items: center; gap: 8px; }
        .toggle-details-btn:hover { background: rgba(17,146,72,0.08); border-color: rgba(17,146,72,0.16); }
        .toggle-sign { font-size: 1.1rem; font-weight: 700; color: #119248; }
        .section-content { display: none; } 
        .section-content.open { display: block; }
          
        .back-to-top { position: fixed; bottom: 20px; right: 20px; z-index: 30; background-color: #1e40af; color: white; border-radius: 50%; padding: 12px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25); transition: background-color 0.3s; }
        .back-to-top:hover { background-color: #1e3a8a; }

        /* Animation WhatsApp */
        @keyframes whatsapp-wave {
            0% { transform: scale(1); opacity: 0.6; }
            100% { transform: scale(1.5); opacity: 0; }
        }
        .whatsapp-float { position: fixed; bottom: 20px; left: 20px; background-color: #25d366; color: white; border-radius: 50%; width: 56px; height: 56px; z-index: 40; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 12px rgba(0,0,0,0.3); transition: transform 0.3s, background-color 0.3s; }
        .whatsapp-float:hover { transform: scale(1.1); background-color: #20ba5a; }
        .whatsapp-float::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; border-radius: 50%; background-color: #25d366; opacity: 0.6; z-index: -1; animation: whatsapp-wave 2s infinite; }
        
        .expertise-box { border-left: 4px solid #22c55e; padding-left: 10px; margin-bottom: 15px; background-color: #f0fdf4; padding: 10px; border-radius: 4px; }
        .fixed-expertise-band { width: 100%; background-color: #166534; color: white; text-align: center; padding: 8px 0; font-size: 0.95rem; position: sticky; top: 80px; z-index: 10; }
        
        .menu-link { transition: background 0.18s; }
        .menu-link:hover { background: #119248; color: #fff !important; }
        .dropdown-menu a { display: block; padding: 8px 12px; color: #1f2937; text-decoration: none; transition: background-color 0.12s; }
        .dropdown-menu a:hover { background-color: #119248; color: #ffffff; }
        
        /* Arrow */
        .scroll-arrow-container { display: flex; flex-direction: column; align-items: center; justify-content: center; margin-top: 10px; margin-bottom: 20px; cursor: pointer; color: #1e40af; transition: opacity 0.5s; }
        .scroll-arrow-container.hidden-arrow { opacity: 0; pointer-events: none; }
        .scroll-text { font-size: 0.8rem; font-weight: 600; text-transform: uppercase; margin-bottom: 4px; color: #1e40af; }
        .scroll-arrow { width: 40px; height: 40px; animation: bounce 2s infinite; }
        @keyframes bounce { 0%, 20%, 50%, 80%, 100% {transform: translateY(0);} 40% {transform: translateY(-10px);} 60% {transform: translateY(-5px);} }

        @media print {
            @page { margin: 2cm; }
            body { background-color: white; padding-top: 0; }
            .print-header, .print-footer { display: flex !important; position: fixed; left: 0; right: 0; background: #fff; }
            .print-header { top: 0; height: 50px; border-bottom: 2px solid #1e40af; z-index: 9999; }
            .print-footer { bottom: 0; height: 30px; border-top: 1px solid #ccc; font-size: 9pt; color: #555; }
            .print-header img { height: 38px; width: auto; }
            .catalog-page { box-shadow: none !important; margin: 0 !important; padding: 0 !important; }
            header, .no-print, .scroll-arrow-container, .toggle-details-btn, .consumables-inline, .whatsapp-float, .back-to-top, #preloader, #onboarding-overlay, .onboarding-tooltip { display: none !important; }
            .no-screen, .section-content, .consumables-popup { display: block !important; position: static !important; width: 100% !important; box-shadow: none !important; margin: 0 !important; }
            .consumables-popup { background: #f9fafb !important; border: 1px solid #eee !important; padding: 10px !important; page-break-inside: avoid; }
            .table-custom { width: 100% !important; border-collapse: collapse !important; }
            .table-custom th { background-color: #1e40af !important; color: #fff !important; }
            .table-custom td { border: 1px solid #ddd !important; }
        }
    </style>
</head>
<body class="loading">

    <div id="preloader">
        <div class="loader-content">
            <img src="logo-multiparts.png" alt="Chargement..." style="height: 50px; margin: 0 auto;">
            <div class="loader-bar-bg"><div class="loader-bar-fill" id="loaderBar"></div></div>
            <div class="loader-text" id="loaderText">Chargement... 0%</div>
        </div>
    </div>

    <div id="onboarding-overlay"></div>
    <div id="onboarding-tooltip" class="onboarding-tooltip"></div>

    <div class="print-header no-screen">
        <img src="logo-multiparts.svg" alt="Logo MULTIPARTS" />
        <span style="font-weight:bold; color:#1e40af;">Catalogue</span>
    </div>
    <div class="print-footer no-screen">
        <span>© 2025 MULTIPARTS</span> <span class="page-counter"></span>
    </div>

    <a href="https://wa.me/2250709399529" class="whatsapp-float no-print" target="_blank" rel="noopener" aria-label="Discuter sur WhatsApp">
        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" viewBox="0 0 16 16">
            <path d="M13.601 2.326A7.854 7.854 0 0 0 7.994 0C3.627 0 .068 3.558.064 7.926c0 1.399.366 2.76 1.057 3.965L0 16l4.204-1.102a7.933 7.933 0 0 0 3.79.965h.004c4.368 0 7.926-3.558 7.93-7.93A7.898 7.898 0 0 0 13.6 2.326zM7.994 14.521a6.573 6.573 0 0 1-3.356-.92l-.24-.144-2.494.654.666-2.433-.156-.251a6.56 6.56 0 0 1-1.007-3.505c0-3.626 2.957-6.584 6.591-6.584a6.56 6.56 0 0 1 4.66 1.931 6.557 6.557 0 0 1 1.928 4.66c-.004 3.639-2.961 6.592-6.592 6.592zm3.615-4.934c-.197-.099-1.17-.578-1.353-.646-.182-.065-.315-.099-.445.099-.133.197-.513.646-.627.775-.114.133-.232.148-.43.05-.197-.1-.836-.308-1.592-.985-.59-.525-.985-1.175-1.103-1.372-.114-.198-.011-.304.088-.403.087-.088.197-.232.296-.346.1-.114.133-.198.198-.33.065-.134.034-.248-.015-.347-.05-.099-.445-1.076-.612-1.47-.16-.389-.323-.335-.445-.34-.114-.007-.247-.007-.38-.007a.729.729 0 0 0-.529.247c-.182.198-.691.677-.691 1.654 0 .977.71 1.916.81 2.049.098.133 1.394 2.132 3.383 2.992.47.205.84.326 1.129.418.475.152.904.129 1.246.08.38-.058 1.171-.48 1.338-.943.164-.464.164-.86.114-.943-.049-.084-.182-.133-.38-.232z"/>
        </svg>
    </a>

    <header class="flex items-center px-4 sm:px-6 py-2 sm:py-4 bg-white shadow-md sticky top-0 z-50 no-print">
        <a href="#top" class="shrink-0 sm:mr-24">
            <img src="logo-multiparts.png" alt="Logo" class="h-10 sm:h-24 w-auto">
        </a>
        <nav class="flex-1 min-w-0 overflow-visible" id="navbar">
            <ul class="flex flex-wrap space-x-2 sm:space-x-8 justify-end sm:justify-start items-center w-full">
                <li class="relative">
                    <button id="sommaireToggle" class="menu-link font-semibold text-black px-2 py-2 rounded inline-flex items-center gap-2 group" 
                            data-step="1" data-text="Naviguer entre les familles de produits.">
                        <svg class="w-5 h-5 text-[#1e40af] group-hover:text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16"></path></svg>
                        <span class="hidden sm:inline">Sommaire</span>
                        <svg class="hidden sm:inline w-4 h-4" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06-.02L10 10.67l3.71-3.48a.75.75 0 111.04 1.08l-4.25 4a.75.75 0 01-1.04 0l-4.25-4a.75.75 0 01-.02-1.06z" clip-rule="evenodd"/></svg>
                    </button>
                    <ul id="sommaireMenu" class="dropdown-menu hidden absolute left-0 mt-2 w-64 bg-white border rounded-md shadow-lg py-2 z-50">
                    </ul>
                </li>
                
                <li>
                    <a href="https://www.google.com/maps/dir/?api=1&destination=4145+Avenue+Paul+Akoto+Yao+Abidjan" target="_blank" rel="noopener" 
                       class="menu-link font-semibold text-black px-2 py-2 rounded inline-flex items-center gap-2 group" 
                       data-step="2" data-text="Trouvez notre itinéraire GPS.">
                       <svg class="w-5 h-5 text-[#1e40af] group-hover:text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.828 0l-4.243-4.243a8 8 0 1111.314 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                       <span class="hidden sm:inline">Localisation</span>
                    </a>
                </li>

                <li>
                    <a href="mailto:rafiou.oyeossi@multipartsci.com?cc=mmultipart@gmail.com&subject=Demande_Informations_Catalogue_Multiparts" 
                       class="menu-link font-semibold text-black px-2 py-2 rounded inline-flex items-center gap-2 group"
                       data-step="3" data-text="Envoyez un email direct.">
                        <svg class="w-5 h-5 text-[#1e40af] group-hover:text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8m-9 11c-2.348 0-4.25-1.902-4.25-4.25S9.652 10.5 12 10.5s4.25 1.902 4.25 4.25S14.348 19 12 19z"></path></svg>
                        <span class="hidden sm:inline">Contact</span>
                    </a>
                </li>

                <li class="relative">
                    <button id="industriesToggle" class="menu-link font-semibold text-black px-2 py-2 rounded inline-flex items-center gap-2 group"
                       data-step="4" data-text="Découvrez nos secteurs d'activité.">
                        <svg class="w-5 h-5 text-[#1e40af] group-hover:text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h-2M5 21h2M12 11V7m0 8v-4m0 8h.01"></path></svg>
                        <span class="hidden sm:inline">Industries</span>
                        <svg class="hidden sm:inline w-4 h-4" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06-.02L10 10.67l3.71-3.48a.75.75 0 111.04 1.08l-4.25 4a.75.75 0 01-1.04 0l-4.25-4a.75.75 0 01-.02-1.06z" clip-rule="evenodd"/></svg>
                    </button>
                    <ul id="industriesMenu" class="dropdown-menu hidden absolute left-0 mt-2 w-64 bg-white border rounded-md shadow-lg py-2 z-50">
                        <li><a href="?ind=mines">Mines</a></li>
                        <li><a href="?ind=petrole-gaz">Pétrole & gaz</a></li>
                        <li><a href="?ind=chimie">Industrie chimique/pétrochimique</a></li>
                        <li><a href="?ind=energie">Énergie & centrales</a></li>
                        <li><a href="?ind=agro">Agro-alimentaire</a></li>
                        <li><a href="?ind=cimenterie">Cimenterie</a></li>
                        <li><a href="?ind=infrastructure">Infrastructure & transport</a></li>
                        <li><a href="?ind=carrieres">Carrières</a></li>
                        <li><a href="?ind=btp">BTP</a></li>
                    </ul>
                </li>

                <li>
                    <button id="shareButton" 
                            class="menu-link font-semibold text-black px-2 py-2 rounded inline-flex items-center gap-2 group"
                            data-step="5" data-text="Partagez le catalogue avec vos contacts.">
                        <svg class="w-5 h-5 text-[#1e40af] group-hover:text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"></path></svg>
                        <span class="hidden sm:inline">Partager</span>
                    </button>
                </li>
            </ul>
        </nav>
    </header>

    <div class="fixed-expertise-band no-print">
        <strong>MULTIPARTS :</strong> 30 ans d'expertise en sourcing critique international à votre service.
    </div>

    <a href="#top" class="back-to-top no-print" title="Retourner en haut du document">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0h6"></path></svg>
    </a>

    <div class="catalog-page page-number" id="top">
        <header class="header">
            <h1 class="text-2xl sm:text-4xl font-extrabold text-[#1e40af]" id="page-title">NOS MARQUES PARTENAIRES</h1>
            <h2 class="text-base sm:text-xl font-semibold text-gray-700 mt-1" id="page-subtitle">Chargement...</h2>
        </header>

        <img class="w-full h-auto rounded-lg mb-6" id="cover-image" src="" alt="Cover">

        <div class="mt-4 p-4 bg-yellow-50 border border-yellow-300 rounded-lg">
            <p class="text-lg font-bold text-yellow-800 mb-2">Présenté par : MULTIPARTS</p>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-x-4 text-sm">
                <div>
                    <p id="company-activity"><strong>Activité :</strong> Fournisseur de solutions et d'équipements pour l'industrie minière et de la construction, expert dans l’approvisionnement en pièces critiques, en composants mécaniques, électriques et en services logistiques soutenant les grands projets industriels.</p>
                </div>
                <div>
                    <p><strong>Adresse :</strong> 4145 Avenue Paul Akoto Yao, Abidjan, Côte d’Ivoire</p>
                    <p><strong>Tél. :</strong> +225 27 21 25 01 46</p>
                    <p><strong>Mobile :</strong> +225 07 09 39 95 29</p>
                    <p><strong>Email :</strong> rafiou.oyeossi@multipartsci.com</p>
                </div>
            </div>
        </div>

        <div class="mt-4 p-4 bg-blue-50 border-l-4 border-blue-600 rounded-r-lg shadow-sm">
            <div class="flex items-start">
                <div class="flex-shrink-0">
                    <svg class="h-6 w-6 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                </div>
                <div class="ml-3">
                    <h3 class="text-sm font-bold text-blue-800 uppercase tracking-wide">Offre Globale & Disponibilité</h3>
                    <div class="mt-1 text-sm text-blue-700">
                        <p>
                            <strong>Machines & Organes Complets :</strong> Au-delà des pièces détachées, nous assurons la fourniture des 
                            <strong>machines neuves</strong> et des <strong>organes complets</strong> (moteurs, boîtes, ponts) de l'ensemble de ces marques partenaires.
                        </p>
                        <p class="mt-2 text-xs italic text-blue-600">
                            * La liste des consommables présentée ci-dessous est donnée à titre indicatif et <strong>n'est pas exhaustive</strong>. Contactez-nous pour toute référence spécifique.
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <h3 id="industries" class="no-screen text-2xl font-bold mt-8 mb-4 border-l-4 border-indigo-500 pl-3">SOMMAIRE DES FAMILLES DE PRODUITS</h3>
        <ol class="no-screen list-decimal ml-6 space-y-1 text-gray-700" id="secteurs-list"></ol>

        <div id="catalog-container"></div>

        <footer class="mt-16 border-t pt-4 text-xs text-gray-600 sm:px-5">
            <p class="font-bold text-sm mb-2">CLAUSES & INFORMATIONS LÉGALES</p>
            <p class="mt-4 text-center px-5 sm:px-0">© 2025 MULTIPARTS Côte d’Ivoire. Tous droits réservés.</p>
        </footer>
    </div>

<script>
// --- LOGIQUE PRINCIPALE ---
document.addEventListener("DOMContentLoaded", async () => {
    
    // 1. Récupérer le paramètre d'industrie (par défaut 'mines')
    const urlParams = new URLSearchParams(window.location.search);
    const industry = urlParams.get('ind') || 'mines';
    const dataFile = `data/${industry}.json`;

    // 2. Charger les données
    try {
        const response = await fetch(dataFile);
        if (!response.ok) throw new Error("Fichier introuvable");
        const data = await response.json();
        
        // 3. Construire la page
        buildPage(data);
        
        // 4. Initialiser les interactions (Scroll, Menus, Onboarding) une fois le DOM prêt
        initInteractions();
        
    } catch (error) {
        console.error("Erreur:", error);
        document.getElementById('page-subtitle').textContent = "Erreur de chargement des données.";
        // Fallback: si erreur, essayer de charger mines par défaut si ce n'était pas le cas
        if (industry !== 'mines') {
            window.location.href = '?ind=mines';
        }
    }
});

function buildPage(data) {
    const esc = s => (s ? String(s).replace(/&/g,'&').replace(/</g,'<').replace(/>/g,'>') : '');

    // A. Remplir le Header & Métadonnées
    document.getElementById('page-title').textContent = data.meta.pageTitle;
    document.getElementById('page-subtitle').textContent = data.meta.pageSubtitle;
    document.getElementById('cover-image').src = data.meta.coverImage;
    document.title = `Catalogue MULTIPARTS - ${data.meta.pageSubtitle}`;
    
    // Injection de la description dynamique (Modification demandée)
    if(data.meta.description) {
        document.getElementById('company-activity').innerHTML = '<strong>Activité :</strong> ' + esc(data.meta.description);
    }

    const container = document.getElementById('catalog-container');
    const summaryList = document.getElementById('secteurs-list');
    const summaryMenu = document.getElementById('sommaireMenu');
    
    container.innerHTML = ''; // Nettoyer
    summaryList.innerHTML = ''; 
    summaryMenu.innerHTML = '';

    // B. Générer les Sections
    data.sections.forEach((section, index) => {
        // 1. Ajouter au sommaire (Page & Menu)
        const linkId = section.id;
        const summaryItem = `<li><a href="#${linkId}" class="text-indigo-600 hover:text-indigo-800 transition duration-150">${esc(section.title)}</a></li>`;
        summaryList.innerHTML += summaryItem;
        summaryMenu.innerHTML += `<li><a href="#${linkId}">${esc(section.title)}</a></li>`;

        // 2. Créer le HTML de la section
        const sectionHTML = `
        <div class="table-group" data-section="${linkId}">
            <div class="section-header" id="${linkId}">
                <div class="flex items-center">
                    <img src="${esc(section.icon)}" class="rounded-md mr-3" alt="Icone">
                    <h3>${esc(section.title)}</h3>
                </div>
                <button type="button" class="toggle-details-btn">
                    <span class="toggle-sign">+</span> Plus de détails
                </button>
            </div>
            <div id="content-${linkId}" class="section-content">
                <div class="expertise-box">
                    <p class="text-gray-700 italic text-sm"><strong>Notre expertise :</strong> ${esc(section.expertiseText)}</p>
                </div>
                <img class="w-1/2 mx-auto h-auto rounded-lg mb-4 block" src="${esc(section.sectionImage)}" alt="${esc(section.title)}">
                
                <div class="scroll-arrow-container no-print" title="Voir les marques">
                    <span class="scroll-text">Voir les Marques</span>
                    <svg class="scroll-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"></path></svg>
                </div>

                <div class="table-container">
                    <table class="w-full table-custom">
                        <thead><tr><th class="w-1/2">${esc(section.tableHeaders[0])}</th><th class="w-1/2">${esc(section.tableHeaders[1])}</th></tr></thead>
                        <tbody>
                            ${section.items.map(item => {
                                const detailsList = item.details.map(d => `<li>${esc(d)}</li>`).join('');
                                const detailsPreview = item.details.slice(0, 3).join(', ') + (item.details.length > 3 ? '…' : '');
                                return `
                                <tr class="brand-row" tabindex="0">
                                    <td>
                                        <strong>${esc(item.brand)}</strong>
                                        <div class="text-sm text-gray-600">${esc(item.specialization)}</div>
                                        <div class="consumables-popup no-print">
                                            <strong>${esc(section.tableHeaders[1])} — ${esc(item.brand)}</strong>
                                            <ul style="margin:0;padding-left:18px;">${detailsList}</ul>
                                        </div>
                                    </td>
                                    <td><div class="consumables-inline">${esc(detailsPreview)}</div></td>
                                </tr>`;
                            }).join('')}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>`;
        
        container.insertAdjacentHTML('beforeend', sectionHTML);
    });
}

function initInteractions() {
    // --- PRELOADER ---
    const preloader = document.getElementById('preloader');
    const bar = document.getElementById('loaderBar');
    const text = document.getElementById('loaderText');
    const images = Array.from(document.images);
    let imagesLoaded = 0;
    const totalImages = images.length;

    function imageLoaded() {
        imagesLoaded++;
        const percent = Math.round((imagesLoaded / totalImages) * 100);
        if(bar) bar.style.width = percent + '%';
        if(text) text.textContent = `Chargement des ressources... ${percent}%`;

        if (imagesLoaded === totalImages) {
            setTimeout(() => {
                if(preloader) {
                    preloader.style.opacity = '0';
                    document.body.classList.remove('loading');
                    setTimeout(() => { preloader.remove(); startOnboarding(); }, 500);
                }
            }, 300);
        }
    }
    if (totalImages === 0) { if(preloader) { preloader.style.display = 'none'; document.body.classList.remove('loading'); startOnboarding(); } } 
    else { images.forEach(img => { if (img.complete) imageLoaded(); else { img.addEventListener('load', imageLoaded); img.addEventListener('error', imageLoaded); } }); }
    
    // Sécurité Preloader (max 6s)
    setTimeout(() => { if(preloader && preloader.style.opacity !== '0') { preloader.style.opacity = '0'; document.body.classList.remove('loading'); setTimeout(() => { preloader.remove(); startOnboarding(); }, 500); } }, 6000);

    // --- LOGIQUE ACCORDÉON & SCROLL ---
    const groups = Array.from(document.querySelectorAll('.table-group'));
    const headerEl = document.querySelector('header');
    const getHeaderOffset = () => (headerEl ? headerEl.offsetHeight + 10 : 80);
    
    function smoothScrollTo(element) {
        if (!element) return;
        const offset = getHeaderOffset();
        const elementPosition = element.getBoundingClientRect().top;
        const offsetPosition = elementPosition + window.pageYOffset - offset;
        window.scrollTo({ top: offsetPosition, behavior: "smooth" });
    }

    groups.forEach((group, index) => {
        const btn = group.querySelector('.toggle-details-btn');
        const content = group.querySelector('.section-content');
        const sign = group.querySelector('.toggle-sign');
        const arrowContainer = group.querySelector('.scroll-arrow-container');
        const tableContainer = group.querySelector('.table-container');

        // Ouvrir la première section par défaut
        if (index === 0) {
            content.classList.add('open');
            btn.setAttribute('aria-expanded', 'true');
            sign.textContent = '−';
        } else {
            content.classList.remove('open');
            btn.setAttribute('aria-expanded', 'false');
            sign.textContent = '+';
        }

        btn.addEventListener('click', () => {
            const isOpen = content.classList.contains('open');
            groups.forEach(g => {
                if(g !== group) {
                    g.querySelector('.section-content').classList.remove('open');
                    g.querySelector('.toggle-details-btn').setAttribute('aria-expanded', 'false');
                    g.querySelector('.toggle-sign').textContent = '+';
                }
            });
            if (isOpen) {
                content.classList.remove('open');
                btn.setAttribute('aria-expanded', 'false');
                sign.textContent = '+';
            } else {
                content.classList.add('open');
                btn.setAttribute('aria-expanded', 'true');
                sign.textContent = '−';
                setTimeout(() => smoothScrollTo(group.querySelector('.section-header')), 50);
            }
        });

        if (arrowContainer && tableContainer) {
            arrowContainer.addEventListener('click', (e) => {
                e.stopPropagation();
                smoothScrollTo(tableContainer);
            });
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        arrowContainer.classList.add('hidden-arrow');
                    } else {
                        if (entry.boundingClientRect.top > 0) {
                             arrowContainer.classList.remove('hidden-arrow');
                        }
                    }
                });
            }, { threshold: 0.2 });
            observer.observe(tableContainer);
        }
    });

    // --- GESTION DES MENUS DÉROULANTS ---
    function setupDropdown(toggleId, menuId) {
        const toggle = document.getElementById(toggleId);
        const menu = document.getElementById(menuId);
        if (toggle && menu) {
            toggle.addEventListener('click', (e) => { 
                e.stopPropagation(); 
                document.querySelectorAll('.dropdown-menu').forEach(m => {
                    if (m !== menu) m.classList.add('hidden');
                });
                menu.classList.toggle('hidden'); 
            });
            
            // Gestion des liens dans le menu généré dynamiquement
            // On utilise la délégation d'événement car les liens n'existaient pas au chargement
            menu.addEventListener('click', (e) => {
                const link = e.target.closest('a');
                if (!link) return;
                
                // Fermer le menu
                menu.classList.add('hidden');
                
                const href = link.getAttribute('href');
                if (href.startsWith('#')) {
                    e.preventDefault();
                    const targetId = href.substring(1);
                    const target = document.getElementById(targetId);
                    if (target) {
                        // Si c'est un lien de section (dans le sommaire)
                        if (target.classList.contains('section-header')) {
                            const group = target.closest('.table-group');
                            const btn = group.querySelector('.toggle-details-btn');
                            if(!group.querySelector('.section-content').classList.contains('open')) btn.click();
                            else smoothScrollTo(target);
                        } else {
                            // Autre ancre
                            smoothScrollTo(target);
                        }
                    }
                }
            });
        }
    }

    setupDropdown('sommaireToggle', 'sommaireMenu');
    setupDropdown('industriesToggle', 'industriesMenu');

    document.addEventListener('click', (e) => {
        document.querySelectorAll('.dropdown-menu').forEach(menu => {
            const toggleBtn = menu.previousElementSibling; 
            if (!menu.contains(e.target) && !toggleBtn.contains(e.target)) {
                menu.classList.add('hidden');
            }
        });
    });
    
    const shareBtn = document.getElementById('shareButton');
    if(shareBtn) {
        shareBtn.addEventListener('click', async () => {
            if (navigator.share) { try { await navigator.share({ title: document.title, url: window.location.href }); } catch(e) {} }
            else { try { await navigator.clipboard.writeText(window.location.href); alert('Lien copié !'); } catch(e) {} }
        });
    }
}

function startOnboarding() {
    return; // ONBOARDING DESACTIVÉ TEMPORAIREMENT
    if (localStorage.getItem('menuOnboardingDone')) return;

    const isMobile = window.innerWidth < 640;
    
    // On cible la première ligne du tableau généré dynamiquement
    const firstRowSelector = '#catalog-container .table-group:first-child tbody tr:first-child';

    const steps = [
        { selector: '[data-step="1"]' }, 
        { selector: '[data-step="2"]' },
        { selector: '[data-step="3"]' },
        { selector: '[data-step="4"]' },
        { selector: '[data-step="5"]' },
        { 
            selector: firstRowSelector, 
            text: isMobile ? "Appuyez sur la marque pour voir la liste des consommables." : "Survolez la marque pour voir la liste des consommables." 
        }
    ];

    let currentStep = 0;
    const overlay = document.getElementById('onboarding-overlay');
    const tooltip = document.getElementById('onboarding-tooltip');
    const navContainer = document.getElementById('navbar');

    if (!overlay || !tooltip) return;

    function showStep(index) {
        if (index >= steps.length) {
            overlay.style.opacity = '0';
            tooltip.classList.remove('show');
            if (window.innerWidth < 640 && navContainer) navContainer.scrollTo({ left: 0, behavior: 'smooth' });
            document.querySelectorAll('.show').forEach(el => el.classList.remove('show'));
            
            setTimeout(() => { overlay.style.display = 'none'; localStorage.setItem('menuOnboardingDone', 'true'); }, 300);
            document.querySelectorAll('.highlight-element').forEach(el => el.classList.remove('highlight-element'));
            return;
        }

        const step = steps[index];
        const element = document.querySelector(step.selector);

        if (element) {
            document.querySelectorAll('.highlight-element').forEach(el => el.classList.remove('highlight-element'));
            element.classList.add('highlight-element');
            
            if(index === 5) {
                element.scrollIntoView({ block: 'center', behavior: 'smooth' });
                element.classList.add('show');
            } else {
                document.querySelectorAll('.brand-row.show').forEach(el => el.classList.remove('show'));
            }
            
            tooltip.textContent = step.text || element.getAttribute('data-text') || "Information";

            const rect = element.getBoundingClientRect();
            let topPos = rect.bottom + 14;
            tooltip.classList.remove('tooltip-top');

            if (index === 5) {
                topPos = rect.top - tooltip.offsetHeight - 14;
                tooltip.classList.add('tooltip-top'); 
            }
            
            tooltip.style.top = topPos + 'px';
            let leftPos = rect.left + (rect.width / 2) - (tooltip.offsetWidth / 2);
            if (leftPos < 10) leftPos = 10;
            if (leftPos + tooltip.offsetWidth > window.innerWidth) leftPos = window.innerWidth - tooltip.offsetWidth - 10;
            
            tooltip.style.left = leftPos + 'px';
            tooltip.classList.add('show');
        }
        
        const stepDuration = (index === 5) ? 5500 : 3500;
        setTimeout(() => { showStep(index + 1); }, stepDuration);
    }
    
    overlay.style.display = 'block';
    overlay.offsetHeight; 
    overlay.style.opacity = '1';
    setTimeout(() => showStep(0), 800);
}
</script>
</body>
</html>
